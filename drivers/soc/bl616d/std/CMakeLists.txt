sdk_generate_library()


if (NOT "${CPU_ID}" STREQUAL "lp")
if ("${CPU_MODEL}" STREQUAL "a0")
set(STARTUP_SUB_DIR "mx")
else()
set(STARTUP_SUB_DIR "mn")
endif()
else()
set(STARTUP_SUB_DIR "lp")
endif()

sdk_library_add_sources(startup/${STARTUP_SUB_DIR}/start.S)
sdk_library_add_sources(startup/${STARTUP_SUB_DIR}/vector.S)
if (NOT "${CPU_ID}" STREQUAL "lp")
sdk_library_add_sources(startup/${STARTUP_SUB_DIR}/riscv_fpu.S)
endif()
sdk_library_add_sources(startup/${STARTUP_SUB_DIR}/start_load.c)
sdk_library_add_sources(startup/${STARTUP_SUB_DIR}/system_bl616d.c)
sdk_library_add_sources(startup/${STARTUP_SUB_DIR}/interrupt.c)

if ("${CPU_ID}" STREQUAL "lp")
unset(CONFIG_ROMAPI CACHE)
set(CONFIG_ROMAPI n CACHE INTERNAL "Override CONFIG_ROMAPI for bl616d")
else()
#set CONFIG_ROMAPI n before chip tapeout
unset(CONFIG_ROMAPI CACHE)
set(CONFIG_ROMAPI n CACHE INTERNAL "Override CONFIG_ROMAPI for bl616d")
endif()

if(CONFIG_ROMAPI)
sdk_library_add_sources(src/bl616d_romapi_e907.c)
sdk_library_add_sources(src/bl616d_romapi_patch.c)
sdk_add_compile_definitions(-DBFLB_USE_ROM_DRIVER)
else()
sdk_library_add_sources(src/bl616d_aon.c)
sdk_library_add_sources(src/bl616d_clock.c)
sdk_library_add_sources(src/bl616d_common.c)
sdk_library_add_sources(src/bl616d_ef_cfg.c)
sdk_library_add_sources(src/bl616d_glb.c)
sdk_library_add_sources(src/bl616d_hbn.c)
sdk_library_add_sources(src/bl616d_pds.c)
sdk_library_add_sources(src/bl616d_psram.c)
sdk_library_add_sources(src/bl616d_sec_dbg.c)
sdk_library_add_sources(src/bl616d_tzc_sec.c)
sdk_library_add_sources(port/bl616d_clock.c)
endif()

sdk_library_add_sources(src/bl616d_pm.c)
sdk_library_add_sources(port/bl616d_reset.c)

if(CONFIG_RF)
    sdk_library_add_sources(src/bl616d_mfg_efuse.c)
    sdk_library_add_sources(src/bl616d_mfg_flash.c)
    sdk_library_add_sources(src/bl616d_mfg_media.c)
endif()

if(CONFIG_STD_BOOTROM_ROMDRIVER)
sdk_library_add_sources(src/bl616d_romdriver_e907.c)
endif()

sdk_add_include_directories(
include
include/hardware
)

if ("${CPU_MODEL}" STREQUAL "a0")
SET(MCPU "e907")
SET(MARCH "rv32imafcpzpsfoperand_xtheade")
SET(MABI "ilp32f")
else()
SET(MCPU "nuclei-900-series")
SET(MARCH "rv32imafdcb_zicond")
SET(MABI "ilp32f")
endif()

if("${CPU_ID}" STREQUAL "ap")
if ("${CPU_MODEL}" STREQUAL "a0")
SET(MCPU "e907")
SET(MARCH "rv32imafcpzpsfoperand_xtheade")
SET(MABI "ilp32f")
else()
SET(MCPU "nuclei-900-series")
SET(MARCH "rv32imafdcb_zicond")
SET(MABI "ilp32f")
endif()
elseif("${CPU_ID}" STREQUAL "np")
if ("${CPU_MODEL}" STREQUAL "a0")
SET(MCPU "e907")
SET(MARCH "rv32imafcpzpsfoperand_xtheade")
SET(MABI "ilp32f")
else()
SET(MCPU "nuclei-900-series")
SET(MARCH "rv32imafdcb_zicond")
SET(MABI "ilp32f")
endif()
elseif("${CPU_ID}" STREQUAL "lp")
SET(MCPU "e902")
SET(MARCH "rv32emcxtheadse")
SET(MABI "ilp32e")
endif()


sdk_add_compile_definitions(-DARCH_RISCV -DBFLB_USE_HAL_DRIVER)
sdk_add_compile_options(-march=${MARCH} -mabi=${MABI} -mtune=${MCPU})
sdk_add_link_options(-march=${MARCH} -mabi=${MABI} -mtune=${MCPU})
sdk_add_private_compile_definitions_ifdef(CONFIG_USB_DISABLED -DCONFIG_USB_DISABLED)

if("${CPU_ID}" STREQUAL "ap")
if("${CPU_MODEL}" STREQUAL "a0")
sdk_add_compile_definitions(-DCONFIG_IRQ_NUM=107)
else()
sdk_add_compile_definitions(-DCONFIG_IRQ_NUM=116)
endif()
elseif("${CPU_ID}" STREQUAL "np")
if("${CPU_MODEL}" STREQUAL "a0")
sdk_add_compile_definitions(-DCONFIG_IRQ_NUM=107)
else()
sdk_add_compile_definitions(-DCONFIG_IRQ_NUM=116)
endif()
elseif("${CPU_ID}" STREQUAL "lp")
sdk_add_compile_definitions(-DCONFIG_IRQ_NUM=112)
endif()
